# Деплой на Render с сохранением данных

## Подготовка к деплою

### 1. Добавление товаров через админку

1. Запустите локальный сервер:
   ```bash
   python manage.py runserver
   ```

2. Откройте админку: http://127.0.0.1:8000/admin/
   - Логин: `user`
   - Пароль: (который вы указали при создании)

3. Добавьте все необходимые автомобили через админку:
   - Заполните всю информацию (марка, модель, год, цена и т.д.)
   - Загрузите качественные изображения
   - Добавьте дополнительные фото если нужно

### 2. Экспорт данных

После добавления всех товаров экспортируйте данные:

```bash
python export_data.py
```

Это создаст папку `export_data/` с:
- `cars_data.json` - данные всех автомобилей
- `images/` - все изображения автомобилей

### 3. Проверка экспорта

Убедитесь, что в папке `export_data/` есть:
- Файл `cars_data.json` с данными
- Папка `images/` с изображениями
- Все изображения корректно скопированы

## Деплой на Render

### 1. Подготовка файлов

Убедитесь, что в корне проекта есть:
- `requirements.txt` - зависимости
- `gunicorn.conf.py` - конфигурация Gunicorn
- `build.sh` - скрипт сборки
- `export_data/` - экспортированные данные

### 2. Настройка Render

1. Создайте новый Web Service на Render
2. Подключите ваш GitHub репозиторий
3. Настройте переменные окружения:
   ```
   ENVIRONMENT=production
   DEBUG=False
   SECRET_KEY=ваш_секретный_ключ
   ```

### 3. Настройка Build Command

В Render используйте:
```bash
pip install -r requirements.txt
python manage.py migrate
python manage.py collectstatic --noinput
```

### 4. Настройка Start Command

```bash
gunicorn korean_cars_shop.wsgi:application
```

## Импорт данных на Render

### 1. Автоматический импорт

Добавьте в `build.sh`:
```bash
#!/usr/bin/env bash
# exit on error
set -o errexit

pip install -r requirements.txt

python manage.py migrate

# Импорт данных если есть экспорт
if [ -f "export_data/cars_data.json" ]; then
    python export_data.py import
fi

python manage.py collectstatic --noinput
```

### 2. Ручной импорт

Если автоматический импорт не сработал:

1. Подключитесь к серверу Render через SSH
2. Загрузите файлы экспорта:
   ```bash
   # Загрузите export_data/ на сервер
   ```

3. Выполните импорт:
   ```bash
   python export_data.py import
   ```

## Проверка деплоя

### 1. Проверка сайта

После деплоя проверьте:
- Главная страница загружается
- Каталог автомобилей отображается
- Изображения загружаются корректно
- Админка работает

### 2. Проверка данных

В админке проверьте:
- Все автомобили импортированы
- Изображения отображаются
- Цены и информация корректны

### 3. Проверка производительности

- Страницы загружаются быстро
- Изображения оптимизированы
- Статические файлы обслуживаются

## Обновление данных

### Добавление новых товаров

1. Добавьте товары локально через админку
2. Экспортируйте данные: `python export_data.py`
3. Загрузите обновленные файлы на сервер
4. Выполните импорт на сервере

### Обновление существующих товаров

1. Отредактируйте товары локально
2. Экспортируйте данные
3. Обновите данные на сервере

## Резервное копирование

### Регулярные бэкапы

1. Экспортируйте данные еженедельно:
   ```bash
   python export_data.py
   ```

2. Сохраните файлы в безопасном месте

3. Документируйте изменения

### Восстановление данных

При необходимости восстановления:
1. Загрузите файлы экспорта на сервер
2. Выполните импорт: `python export_data.py import`

## Устранение проблем

### Проблемы с изображениями

1. Проверьте права доступа к папке media/
2. Убедитесь, что изображения загружены
3. Проверьте настройки STATIC_URL и MEDIA_URL

### Проблемы с базой данных

1. Проверьте миграции: `python manage.py migrate`
2. Создайте суперпользователя: `python manage.py createsuperuser`
3. Проверьте подключение к базе данных

### Проблемы с производительностью

1. Оптимизируйте изображения
2. Настройте кэширование
3. Проверьте настройки whitenoise

## Полезные команды

```bash
# Проверка статуса
python manage.py check

# Создание миграций
python manage.py makemigrations

# Применение миграций
python manage.py migrate

# Создание суперпользователя
python manage.py createsuperuser

# Сбор статических файлов
python manage.py collectstatic

# Экспорт данных
python export_data.py

# Импорт данных
python export_data.py import
``` 